<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ddx: Theory</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">ddx<span id="projectnumber">&#160;0.6.8</span>
   </div>
   <div id="projectbrief">Libary for domain-decomposition methods for polarizable continuum models</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md_docs_theory.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Theory </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md12"></a>
Introduction</h1>
<h1><a class="anchor" id="autotoc_md13"></a>
Cavity and solute density</h1>
<p >ddX considers vdW- and SAS-cavities that can be defined by a set of \(M\) balls \(\Omega_j\) each of which is located at \(\textbf{x}_j\in\mathbb R^3\) with radius \(r_j\in\mathbb R\). The region occupied by the solute molecule is given by </p><p class="formulaDsp">
\[
    \Omega = \cup_{j=1}^M \Omega_j.
\]
</p>
<p> The charge density of the solute molecule is denoted by \(\rho\) and it can consist of point-charges (partial charges) for classical models or nuclear point-charges with electronic densities for quantum-mechanical models. Within ddX, the solute molecule is completely described by the cavity \(\Omega\) and the charge distribution \(\rho\). The methods used in ddX assume that the charge \(\rho\) is supported in \(\Omega\), i.e. \(\rho(\textbf{x})=0\) for \(\textbf{x}\in\mathbb R^3\backslash\Omega\).</p>
<h2><a class="anchor" id="autotoc_md14"></a>
Fundamental solutions and free-space potentials</h2>
<p >The free-space potential, i.e. the potential generated by \(\rho\) in vacuum, is then defined by </p><p class="formulaDsp">
\[
    \Phi(\textbf{x}) = \int_{\Omega} \rho(\textbf{y}) \, G_0(|\textbf{x}-\textbf{y}|) d\textbf{y}
    \qquad\textrm{ and satisfies }\qquad
    -\Delta \Phi = 4\pi \rho, \textrm{ in } \mathbb R^3,
\]
</p>
<p> where \(G_0(r) = \frac{1}{4\pi r} \) denotes the fundamental solution of the Laplace-operator \(\mathcal L_\Delta=-\Delta\). We also introduce the Yukawa-potential \(G_\kappa(r) = \frac{e^{-\kappa r}}{4\pi r} \), which is the fundamental solution of the operator \(\mathcal L_\kappa = -\Delta+\kappa^2\).</p>
<h1><a class="anchor" id="autotoc_md15"></a>
Models</h1>
<p >The three methods COSMO, PCM and LPB differ by the model of the physical between the solute and the implicit/bulk solvent.</p>
<h2><a class="anchor" id="autotoc_md16"></a>
Linearized Poisson-Boltzmann model (LPB)</h2>
<p >The LPB-model is the most general one of the three models and the (implicit) solvent is assumed to be homogeneous continuum with relative dielectric permittivity \(\varepsilon_s\) and Debye HÃ¼ckel constant \(\kappa_s\). Then the LPB-equations are given by: find the potential \(V\) solution to </p><p class="formulaDsp">
\[
    -\nabla\cdot (\varepsilon\nabla V) + \kappa^2 V = 4\pi \rho, \qquad \textrm{in } \mathbb R^3,
\]
</p>
<p> where </p><p class="formulaDsp">
\[
    \varepsilon(\textbf{x}) = 
    \begin{cases}
    1 &amp; \textrm{if } \textbf{x}\in\Omega, \\
    \varepsilon_s &amp; \textrm{otherwise}, 
    \end{cases}
    \qquad\textrm{ and }\qquad
    \kappa(\textbf{x}) = 
    \begin{cases}
    0 &amp; \textrm{if } \textbf{x}\in\Omega, \\
    \sqrt{\varepsilon_s}\kappa_s &amp; \textrm{otherwise}.
    \end{cases}
\]
</p>
<p >ddLPB is based on the following coupled equations: find the reaction-potential \(W=V-\Phi\) and the auxilliary potential \(V_e\) that satisfy </p><p class="formulaDsp">
\begin{align*}
    -\Delta W &amp;= 0, &amp;&amp; \textrm{in }\Omega, \\
    -\Delta V_e + \kappa_s^2 V_e^2 &amp;= 0, &amp;&amp;\textrm{in }\Omega,
\end{align*}
</p>
<p> with (nonlocal) boundary conditions </p><p class="formulaDsp">
\begin{align*}
    W + \Phi &amp;= V_e, &amp;&amp; \textrm{on }\partial\Omega, \\
   V_e + S_\kappa\big(\tfrac{1}{\varepsilon_s} \partial_n W - \partial_n V_e\big) &amp;= -S_\kappa\big(\tfrac{1}{\varepsilon_s} \partial_n \Phi\big), &amp;&amp; \textrm{on }\partial\Omega,
\end{align*}
</p>
<p> where \(S_\kappa\) denotes the single-layer potential with respect to the operator \(\mathcal L_\kappa\) defined by </p><p class="formulaDsp">
\begin{align*}
    (S_\kappa\sigma)(\textbf{s}) &amp;= \int_{\partial\Omega} \sigma(\textbf{s&#39;}) \, G_\kappa(|\textbf{s}-\textbf{s&#39;}|) \, d\textbf{s&#39;}.
\end{align*}
</p>
<p> Note that \(\partial_n=\frac{\partial}{\partial n}\) stands for the normal derivative.</p>
<h2><a class="anchor" id="autotoc_md17"></a>
Polarizable Continuum Model (PCM)</h2>
<p >The PCM is the particular case of LPB with \(\kappa_s=0\). ddPCM relies on the following equivalent Integral-Equation formulation: find the charge density \(\sigma\) and the intermediate potential \(\Phi_\varepsilon\) that satisfy </p><p class="formulaDsp">
\begin{align*}
    R_\varepsilon \Phi_\varepsilon &amp;= R_\infty \Phi, &amp;&amp;\textrm{on }\partial\Omega, \\
    S \sigma &amp;= -\Phi_\varepsilon, &amp;&amp;\textrm{on }\partial\Omega,
\end{align*}
</p>
<p> where </p><p class="formulaDsp">
\[
    R_\varepsilon = 2\pi \frac{\varepsilon_s+1}{\varepsilon_s-1} I - D,
\]
</p>
<p> and \(S\) and \(D\) denote the single and double-layer boundary operators respectively with respect to the Laplace-operator \(\mathcal L_\Delta\) defined by </p><p class="formulaDsp">
\begin{align*}
    \forall \textbf{s}\in\partial\Omega: \qquad
    (S\sigma)(\textbf{s}) &amp;= \int_{\partial\Omega} \sigma(\textbf{s&#39;}) \, G_0(|\textbf{s}-\textbf{s&#39;}|) \, d\textbf{s&#39;}, \\
    \forall \textbf{s}\in\partial\Omega: \qquad
    (D\sigma)(\textbf{s}) &amp;= \int_{\partial\Omega} \sigma(\textbf{s&#39;}) \, \frac{\partial}{\partial n(\textbf{s&#39;})} \, G_0(|\textbf{s}-\textbf{s&#39;}|) \, d\textbf{s&#39;}.
 \end{align*}
</p>
<p> Note that \(n(\textbf{s&#39;})\) denotes the outward-pointing unit normal at \(\textbf{s&#39;}\in\partial\Omega\).</p>
<h2><a class="anchor" id="autotoc_md18"></a>
COnductor-like Screening MOdel (COSMO)</h2>
<p >The COSMO is the particular case of PCM with \(\varepsilon_s=+\infty\), i.e. the solvent is assumed to be a perfect conductor. In consequence, \(V=0\) in \(\mathbb R^3\backslash \Omega\) and the problem reduces to </p><p class="formulaDsp">
\[
    -\Delta V = 4\pi \rho, \qquad \textrm{in } \Omega,
\]
</p>
<p> which,for \(W=V-\Phi\), can be reformulated as <br  />
 </p><p class="formulaDsp">
\begin{align*}
    -\Delta W &amp;= 0, &amp;&amp; \textrm{in } \Omega,
    \\
    W &amp;= - \Phi, &amp;&amp; \textrm{on } \partial\Omega.
\end{align*}
</p>
<p> The corresponding Integral-Equation formulation is: find the charge density \(\sigma:\partial\Omega\to\mathbb R\) such that </p><p class="formulaDsp">
\[
    S\sigma = - \Phi, \qquad \textrm{on } \partial\Omega,
\]
</p>
<p> and \(\sigma\) relates to \(W\) through </p><p class="formulaDsp">
\[
    \forall \textbf{x}\in\mathbb R^3: \qquad W(\textbf{x}) = \int_{\partial\Omega} \sigma(\textbf{y}) \, G_0(|\textbf{x}-\textbf{y}|) \, d\textbf{y}.
\]
</p>
<h3><a class="anchor" id="autotoc_md19"></a>
General remarks</h3>
<ol type="1">
<li>As \(\varepsilon_s\to\infty\), the solution to the PCM becomes the COSMO solution. The first PCM equation yields \(\Phi_\varepsilon \to \Phi\) and the second PCM equation corresponds to the Integral-Equation formulation of COSMO.</li>
<li>lpb different formulation</li>
</ol>
<p >In all three models, the solvation energy \(E_s\) is defined as </p><p class="formulaDsp">
\[
    E_s=\frac12 \int_{\Omega} \rho(\textbf{x}) \, W(\textbf{x}) \, d\textbf{x},
\]
</p>
<p> where \(W=V-\Phi\) denotes the reaction-potential and the force-vector \(F_i\) acting on the \(i\)th atom corresponding to the solvation energy is given by </p><p class="formulaDsp">
\[
    F_i = -\nabla_{\textbf{x}_i} E_s.
\]
</p>
<h1><a class="anchor" id="autotoc_md20"></a>
Discrete equations in a general framework - overview</h1>
<p >The resulting linear system for all three methods can be written in the general form </p><p class="formulaDsp">
\[
        \tilde{\operatorname{L}} \tilde{\operatorname{X}} = \tilde{\operatorname{F}},
\]
</p>
<p> and the (approximate) energy can be computed as </p><p class="formulaDsp">
\[
    E_s = \frac12 \langle \tilde \Psi, \tilde{\operatorname{X}} \rangle,
\]
</p>
<p> where \(\langle \cdot, \cdot \rangle\) denotes the scalar product of the two enclosed vectors. </p>
<h2><a class="anchor" id="autotoc_md21"></a>
ddCOSMO:</h2>
<p class="formulaDsp">
\[
    \tilde{\operatorname{L}} = \begin{pmatrix} \operatorname{L} &amp; 0 \\ 0 &amp; 0 \end{pmatrix}
    \qquad
    \tilde{\operatorname{X}} = \begin{pmatrix} \operatorname{X} \\ 0 \end{pmatrix}
    \qquad
    \tilde{\operatorname{F}} = \begin{pmatrix} -\Phi \\ 0 \end{pmatrix}
    \qquad
    \tilde{\Psi} = f(\varepsilon)\begin{pmatrix} \Psi \\ 0 \end{pmatrix}
\]
</p>
<p> <em>Note</em>: The notation used in the ddCOSMO-literature, see e.g. [1,2,7], uses \(\operatorname{g} = -\Phi\). The references [1&ndash;9] also give the definition of the matrix \(\operatorname{L}\) and the vectors \(\operatorname{g} = -\Phi\), \(\Psi\) as well as the scalar function \(f(\varepsilon)\).</p>
<p >The subroutine for matrix-vector multiplications of the \({\operatorname{L}}\) with a vector is </p><div class="fragment"><div class="line">&gt; lx(...)     in ddx_operators.f90</div>
</div><!-- fragment --> <h2><a class="anchor" id="autotoc_md22"></a>
ddPCM:</h2>
<p class="formulaDsp">
\[
    \tilde{\operatorname{L}} = \begin{pmatrix} \operatorname{L} &amp; \operatorname{I}_d \\ 0 &amp; \operatorname{R}_\varepsilon \end{pmatrix}
    \qquad
    \tilde{\operatorname{S}} = \begin{pmatrix} \operatorname{X} \\ \Phi_\varepsilon \end{pmatrix}
    \qquad
    \tilde{\operatorname{F}} = \begin{pmatrix} \operatorname{0} \\ \operatorname{R}_\infty\Phi \end{pmatrix}
    \qquad
    \tilde{\Psi} = \begin{pmatrix} \Psi \\ 0 \end{pmatrix}
\]
</p>
<p> <em>Note</em>: The notation used in the references [10,11], uses \(\sigma = \operatorname{X}\). The references [10&ndash;13] also give the definition of the matrices \(\operatorname{R}_\varepsilon\), \(\operatorname{R}_\infty\) and the vector \(\operatorname{g} = -\Phi\). \(\operatorname{I}_d\) denotes the identity matrix.</p>
<p >The subroutine for matrix-vector multiplications of the \(\operatorname{R}_\varepsilon\) and \(\operatorname{R}_\infty\) with a vector is </p><div class="fragment"><div class="line">&gt; repsx(...)     in ddx_operators.f90</div>
<div class="line">&gt; rinfx(...)     in ddx_operators.f90</div>
</div><!-- fragment --> <h2><a class="anchor" id="autotoc_md23"></a>
ddLPB:</h2>
<p class="formulaDsp">
\[
    \tilde{\operatorname{L}} = \tilde{\operatorname{T}} = \begin{pmatrix} \operatorname{A} &amp; 0 \\ 0 &amp; \operatorname{B} \end{pmatrix} + \tilde{\operatorname{C}}
    \qquad
    \tilde{\operatorname{C}} = \begin{pmatrix} \operatorname{C}_1 &amp; \operatorname{C}_2 \\ \operatorname{C}_1 &amp; \operatorname{C}_2 \end{pmatrix}
    \qquad
    \tilde{\operatorname{X}} = \begin{pmatrix} \operatorname{X} \\ \operatorname{X}_e \end{pmatrix}
    \qquad
    \tilde{\operatorname{F}} = \begin{pmatrix} \operatorname{F}_0-\Phi \\ \operatorname{F}_0 \end{pmatrix}
    \qquad
    \tilde{\Psi} = \begin{pmatrix} \Psi \\ 0 \end{pmatrix}
\]
</p>
<p> <em>Note</em>: The notation used in the ddLPB-literature, see e.g. [14,15], uses \(\operatorname{X}_r = \operatorname{X}\) and \(\operatorname{G}_0 = -\Phi\). These references also provide the definition of the matrices \(\operatorname{A}\) (which is a scaled verion of \(\operatorname{L}\)), \(\operatorname{B}\), \(\operatorname{C}_1\), \(\operatorname{C}_2\) as well as the vectors \(\operatorname{F}_0\), \(\operatorname{G}_0 = -\Phi\).</p>
<p >The subroutine for matrix-vector multiplications of the \(\tilde{\operatorname{T}}\), \(\operatorname{A}\), \(\operatorname{B}\) and \(\tilde{\operatorname{C}}\) with a vector is </p><div class="fragment"><div class="line">&gt; tx(...)     in ddx_operators.f90</div>
<div class="line">&gt; ax(...)     in ddx_operators.f90</div>
<div class="line">&gt; bx(...)     in ddx_operators.f90</div>
<div class="line">&gt; cx(...)     in ddx_operators.f90</div>
</div><!-- fragment --> <h1><a class="anchor" id="autotoc_md24"></a>
Gradient computations</h1>
<p >The derivative of the energy with respect to a parameter \(\lambda\) is computed using the adjoint method </p><p class="formulaDsp">
\begin{align*}
E^\lambda_s 
&amp;= \frac12 \langle \tilde \Psi^\lambda, \tilde{\operatorname{X}} \rangle + \frac12 \langle \tilde \Psi, \tilde{\operatorname{X}}^\lambda \rangle
= \frac12 \langle \tilde \Psi^\lambda, \tilde{\operatorname{X}} \rangle + \frac12 \langle \tilde{\operatorname{S}}, \tilde{\operatorname{H}} \rangle 
\end{align*}
</p>
<p> where \(\tilde{\operatorname{S}}\) is solution to the adjoint linear system </p><p class="formulaDsp">
\[
            \tilde{\operatorname{L}}^\top \tilde{\operatorname{S}} = \tilde{\Psi},
\]
</p>
<p> and </p><p class="formulaDsp">
\[
    \tilde{\operatorname{H}} = \tilde{\operatorname{F}}^\lambda - \tilde{\operatorname{L}}^\lambda \tilde{\operatorname{X}}.
\]
</p>
 <h2><a class="anchor" id="autotoc_md25"></a>
ddCOSMO:</h2>
<p class="formulaDsp">
\[
    \tilde{\operatorname{L}}^\top = \begin{pmatrix} \operatorname{L}^\top &amp; 0 \\ 0 &amp; 0 \end{pmatrix}
    \qquad
    \tilde{\operatorname{S}} = \begin{pmatrix} \operatorname{S} \\ 0 \end{pmatrix}
    \qquad
    \tilde{\operatorname{H}} = \begin{pmatrix} -\Phi^\lambda - \operatorname{L}^\lambda \operatorname{X} \\ 0 \end{pmatrix}
\]
</p>
<p> The subroutine for matrix-vector multiplications of the \(\tilde{\operatorname{L}}^\top\) with a vector is </p><div class="fragment"><div class="line">&gt; lstarx(...)     in ddx_operators.f90</div>
</div><!-- fragment --><p> The term \(\langle \tilde{\operatorname{S}}, \tilde{\operatorname{H}} \rangle\) then writes </p><p class="formulaDsp">
\[
    \langle \tilde{\operatorname{S}}, \tilde{\operatorname{H}} \rangle
    = 
    - \langle \operatorname{S}, \Phi^\lambda\rangle
    - \langle \operatorname{S}, \operatorname{L}^\lambda\operatorname{X} \rangle
\]
</p>
<p> The subroutine for the contraction of the differentiated matrix \(\operatorname{L}^\lambda\) with two vectors is </p><div class="fragment"><div class="line">&gt; contract_grad_l(...)     in ddx_gradients.f90</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md26"></a>
ddPCM:</h2>
<p class="formulaDsp">
\[
    \tilde{\operatorname{L}}^\top = \begin{pmatrix} \operatorname{L}^\top &amp; 0 \\ \operatorname{I}_d &amp; \operatorname{R}_\varepsilon^\top \end{pmatrix}
    \qquad
    \tilde{\operatorname{S}} = \begin{pmatrix} \operatorname{S} \\ -\operatorname{Y} \end{pmatrix}
    \qquad
    \tilde{\operatorname{H}} = \begin{pmatrix} -\operatorname{L}^\lambda\operatorname{X} \\ \operatorname{R}^\lambda(\Phi-\Phi_\varepsilon)+\operatorname{R}_\infty\Phi^\lambda \end{pmatrix}
\]
</p>
<p> <em>Note</em>: The minus sign in front of \(\operatorname{Y}\) appears for consistency with the notation introduced in [12].</p>
<p >The subroutine for matrix-vector multiplications of the \(\operatorname{R}_\varepsilon^\top\) and \(\operatorname{R}_\infty^\top\) with a vector is </p><div class="fragment"><div class="line">&gt; repsstarx(...)     in ddx_operators.f90</div>
<div class="line">&gt; rinfstarx(...)     in ddx_operators.f90</div>
</div><!-- fragment --><p> <b>Remarks</b>:</p><ol type="1">
<li>There holds \(\operatorname{S}=\operatorname{R}_\varepsilon^\top\operatorname{Y}\).</li>
<li>Since \(\operatorname{R}_\infty-\operatorname{R}_\varepsilon=-\frac{4\pi}{\varepsilon_s-1}\) is constant there holds \(\operatorname{R}^\lambda:=\operatorname{R}^\lambda_\varepsilon=\operatorname{R}^\lambda_\infty\).</li>
<li>As consequence of 1. and 2., it is advantageous to write <p class="formulaDsp">
\[
    \langle \tilde{\operatorname{S}}, \tilde{\operatorname{H}} \rangle
    = 
    - \langle \operatorname{S}, \operatorname{L}^\lambda\operatorname{X} \rangle
    + \langle \operatorname{Y}, \operatorname{R}^\lambda(\Phi_\varepsilon-\Phi) \rangle
    -  \langle \operatorname{Q}, \Phi^\lambda \rangle
    \qquad 
    \operatorname{Q} := \operatorname{S} - \frac{4\pi}{\varepsilon_s-1} \operatorname{Y}.
\]
</p>
</li>
</ol>
<p >The subroutine for the contraction of the differentiated matrix \(\operatorname{R}^\lambda\) with two vectors is </p><div class="fragment"><div class="line">&gt; contract_gradr(...)     in ddx_gradients.f90</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md27"></a>
ddLPB:</h2>
<p class="formulaDsp">
\[
    \tilde{\operatorname{L}}^\top = \tilde{\operatorname{T}}^\top = \begin{pmatrix} \operatorname{A}^\top &amp; 0 \\ 0 &amp; \operatorname{B}^\top \end{pmatrix} + \tilde{\operatorname{C}}^\top
    \qquad
    \tilde{\operatorname{C}}^\top = \begin{pmatrix} \operatorname{C}_1^\top &amp; \operatorname{C}_1^\top \\ \operatorname{C}_2^\top &amp; \operatorname{C}_2^\top \end{pmatrix}
    \qquad
    \tilde{\operatorname{X}} = \begin{pmatrix} \operatorname{S} \\ \operatorname{S}_e \end{pmatrix}
    \qquad
    \tilde{\operatorname{H}} = \begin{pmatrix} 
        \operatorname{F}_0^\lambda-\Phi^\lambda - \operatorname{A}^\lambda - \operatorname{C}_1^\lambda \operatorname{X} - \operatorname{C}_2^\lambda \operatorname{X}_e 
        \\
        \operatorname{F}_0^\lambda - \operatorname{B}^\lambda - \operatorname{C}_1^\lambda \operatorname{X} - \operatorname{C}_2^\lambda \operatorname{X}_e 
     \end{pmatrix}
\]
</p>
<p> The subroutine for matrix-vector multiplications of the \(\tilde{\operatorname{T}}^\top\), \(\operatorname{A}^\top\), \(\operatorname{B}^\top\) and \(\tilde{\operatorname{C}}^\top\) with a vector is </p><div class="fragment"><div class="line">&gt; tstarx(...)     in ddx_operators.f90</div>
<div class="line">&gt; astarx(...)     in ddx_operators.f90</div>
<div class="line">&gt; bstarx(...)     in ddx_operators.f90</div>
<div class="line">&gt; cstarx(...)     in ddx_operators.f90</div>
</div><!-- fragment --><p> The term \(\langle \tilde{\operatorname{S}}, \tilde{\operatorname{H}} \rangle\) then writes </p><p class="formulaDsp">
\[
    \langle \tilde{\operatorname{S}}, \tilde{\operatorname{H}} \rangle
    = 
    \langle \operatorname{S}, \operatorname{F}_0^\lambda-\Phi\lambda^\rangle
    + \langle \operatorname{S}_e, \operatorname{F}_0^\lambda\rangle
    - \langle \operatorname{S}, \operatorname{A}^\lambda\operatorname{X} \rangle
    - \langle \operatorname{S}_e, \operatorname{B}^\lambda\operatorname{X}_e \rangle
    - \langle \tilde{\operatorname{S}}, \tilde{\operatorname{C}}_1^\lambda\tilde{\operatorname{X}} \rangle.
\]
</p>
<p> The subroutine for the contraction of the differentiated matrices \(\operatorname{A}^\lambda\), \(\operatorname{B}^\lambda\) and \(\tilde{\operatorname{C}}^\lambda\) with two vectors is </p><div class="fragment"><div class="line">&gt; contract_grad_a(...)     in ddx_gradients.f90</div>
<div class="line">&gt; contract_grad_b(...)     in ddx_gradients.f90</div>
<div class="line">&gt; contract_grad_c(...)     in ddx_gradients.f90</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.4 </li>
  </ul>
</div>
</body>
</html>
